<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador 3D da Estante Pedagógica (1,40m)</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
            background-color: #e8e8e8;
            color: #333;
        }
        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
        #info {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 95%;
            max-width: 800px;
            text-align: center;
            z-index: 100;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 12px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            backdrop-filter: blur(5px);
        }
        #info h1 {
            margin: 0 0 5px 0;
            font-size: 1.4em;
            color: #2c3e50;
        }
        #info p {
            margin: 0;
            font-size: 0.9em;
        }
        #tooltip {
            position: absolute;
            display: none;
            background-color: rgba(44, 62, 80, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 14px;
            pointer-events: none;
            z-index: 101;
            transition: opacity 0.2s;
            max-width: 250px;
        }
        #tooltip h3 {
            margin: 0 0 5px 0;
            font-size: 16px;
            border-bottom: 1px solid rgba(255,255,255,0.3);
            padding-bottom: 5px;
        }
        #tooltip p {
            margin: 0;
            font-size: 13px;
        }
        #labels-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        .label {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.85);
            color: #2c3e50;
            padding: 4px 8px;
            border-radius: 5px;
            font-size: 13px;
            font-weight: 600;
            transform: translate(-50%, -50%);
            white-space: nowrap;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: opacity 0.2s;
        }
    </style>
</head>
<body>

    <div id="info">
        <h1>Estante Pedagógica - Projeto Final (1,40m)</h1>
        <p>Use o mouse para interagir: <strong>Esquerdo:</strong> Girar | <strong>Roda:</strong> Zoom | <strong>Direito:</strong> Mover</p>
    </div>

    <div id="tooltip"></div>
    <div id="labels-container"></div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.164.1/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.164.1/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        let intersectedObject = null;
        let mouseX = 0, mouseY = 0;

        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 2000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        const controls = new OrbitControls(camera, renderer.domElement);
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        const tooltip = document.getElementById('tooltip');
        const labelsContainer = document.getElementById('labels-container');
        const interactiveObjects = [];
        const labels = [];

        function init() {
            // --- Configuração da Cena ---
            scene.background = new THREE.Color(0xe8e8e8);
            scene.fog = new THREE.Fog(0xe8e8e8, 400, 1200);

            camera.position.set(150, 160, 280);

            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.body.appendChild(renderer.domElement);

            // --- Controles ---
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.minDistance = 100;
            controls.maxDistance = 800;
            controls.maxPolarAngle = Math.PI / 2.1;

            // --- Iluminação ---
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.2);
            directionalLight.position.set(-150, 250, 200);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.set(2048, 2048);
            scene.add(directionalLight);
            
            // --- Chão ---
            const ground = new THREE.Mesh(
                new THREE.PlaneGeometry(2000, 2000),
                new THREE.MeshStandardMaterial({ color: 0xdcdcdc, roughness: 0.8 })
            );
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);

            buildBookshelf();
            
            window.addEventListener('mousemove', onMouseMove, false);
            window.addEventListener('resize', onWindowResize, false);
        }

        function buildBookshelf() {
            const shelfGroup = new THREE.Group();
            const alturaTotal = 140, larguraTotal = 220, profundidadeTotal = 30, espessura = 1.5;
            const mdfMaterial = new THREE.MeshStandardMaterial({ color: 0xffffff, roughness: 0.9 });

            // --- Estrutura Principal ---
            shelfGroup.add(new THREE.Mesh(new THREE.BoxGeometry(espessura, alturaTotal, profundidadeTotal), mdfMaterial).translateX(-larguraTotal / 2 + espessura / 2));
            shelfGroup.add(new THREE.Mesh(new THREE.BoxGeometry(espessura, alturaTotal, profundidadeTotal), mdfMaterial).translateX(larguraTotal / 2 - espessura / 2));
            shelfGroup.add(new THREE.Mesh(new THREE.BoxGeometry(larguraTotal - 2 * espessura, espessura, profundidadeTotal), mdfMaterial).translateY(-alturaTotal/2 + espessura/2));
            shelfGroup.add(new THREE.Mesh(new THREE.BoxGeometry(larguraTotal - 2 * espessura, espessura, profundidadeTotal), mdfMaterial).translateY(alturaTotal/2 - espessura/2));
            shelfGroup.add(new THREE.Mesh(new THREE.BoxGeometry(espessura, alturaTotal - 2 * espessura, profundidadeTotal), mdfMaterial));
            shelfGroup.add(new THREE.Mesh(new THREE.BoxGeometry(larguraTotal, alturaTotal, 0.3), mdfMaterial).translateZ(-profundidadeTotal/2 + 0.15));

            const larguraVao = (larguraTotal - 3 * espessura) / 2;
            const prateleiraGeo = new THREE.BoxGeometry(larguraVao, espessura, profundidadeTotal);
            const espacoVaoVertical = (alturaTotal - 5 * espessura) / 4;

            for (let i = 1; i <= 3; i++) {
                const yPos = -alturaTotal/2 + (espessura + espacoVaoVertical) * i;
                shelfGroup.add(new THREE.Mesh(prateleiraGeo, mdfMaterial).position.set(-(larguraVao + espessura) / 2, yPos, 0));
                shelfGroup.add(new THREE.Mesh(prateleiraGeo, mdfMaterial).position.set((larguraVao + espessura) / 2, yPos, 0));
            }
            
            shelfGroup.children.forEach(child => child.castShadow = true);
            shelfGroup.position.y = alturaTotal / 2;
            scene.add(shelfGroup);

            // --- Seções Interativas, Livros e Títulos ---
            const sectionContent = [
                { title: "Contos Clássicos", description: "Histórias infantis, poesias e livros de texturas e sons.", colors: ['#FFC300', '#3375FF', '#FF5733'] },
                { title: "Formas e Cores", description: "Explorando o mundo através de formas geométricas e cores primárias.", colors: ['#FF5733', '#FFC300', '#3375FF'] },
                { title: "Mundo Animal", description: "Primeiras curiosidades sobre os animais e seus diversos habitats.", colors: ['#28B463', '#AF601A', '#F39C12'] },
                { title: "Biomas do Mundo", description: "Conhecendo os biomas brasileiros e a diversidade da natureza.", colors: ['#935116', '#52BE80', '#2E86C1'] },
                { title: "Viagem ao Cosmos", description: "Curiosidades sobre os planetas, estrelas e o universo.", colors: ['#154360', '#BDC3C7', '#212F3D'] },
                { title: "Mistérios do Oceano", description: "Descobrindo os segredos da vida marinha e dos mares.", colors: ['#1A5276', '#AED6F1', '#85C1E9'] },
                { title: "Grandes Histórias", description: "Fatos históricos marcantes como o Império Romano e as Grandes Guerras.", colors: ['#641E16', '#784212', '#922B21'] },
                { title: "Biografias Inspiradoras", description: "A vida de personalidades como Tesla, Newton e Joana D'arc.", colors: ['#7B241C', '#F1C40F', '#512E5F'] }
            ];
            
            const triggerGeo = new THREE.BoxGeometry(larguraVao, espacoVaoVertical, profundidadeTotal - 1);
            const triggerMaterial = new THREE.MeshBasicMaterial({ transparent: true, opacity: 0 });

            let contentIndex = 0;
            for (let i = 0; i < 4; i++) { // Níveis
                for (let j = -1; j <= 1; j += 2) { // Lado (Esquerda/Direita)
                    const yPos = -alturaTotal/2 + espessura + espacoVaoVertical/2 + (espacoVaoVertical + espessura) * i;
                    const xPos = j * (larguraVao + espessura) / 2;

                    const trigger = new THREE.Mesh(triggerGeo, triggerMaterial);
                    trigger.position.set(xPos, yPos, 0);
                    trigger.userData = sectionContent[contentIndex];
                    shelfGroup.add(trigger);
                    interactiveObjects.push(trigger);

                    const labelDiv = document.createElement('div');
                    labelDiv.className = 'label';
                    labelDiv.textContent = sectionContent[contentIndex].title;
                    labelsContainer.appendChild(labelDiv);
                    labels.push({ trigger: trigger, element: labelDiv });

                    fillSection(xPos, yPos, larguraVao, espacoVaoVertical, sectionContent[contentIndex].colors, shelfGroup);
                    contentIndex++;
                }
            }
        }

        function createBook(w, h, d, color) {
            const mat = new THREE.MeshStandardMaterial({ color: color, roughness: 0.7 });
            const geo = new THREE.BoxGeometry(w, h, d);
            const book = new THREE.Mesh(geo, mat);
            book.castShadow = true;
            return book;
        }
        
        function fillSection(x, y, w, h, colors, group) {
            for(let i=0; i < 5; i++) {
                // Tamanhos corrigidos para não clipar
                const bookW = 8 + Math.random() * (w / 4.5);
                const bookH = h * 0.7 + Math.random() * (h * 0.25);
                const bookD = 26; // Profundidade segura e consistente

                const book = createBook(bookW, bookH, bookD, colors[i % colors.length]);
                
                // Posicionamento horizontal corrigido para ficar dentro dos limites
                const randomXOffset = (Math.random() - 0.5) * (w - bookW - 4); // -4 para uma margem
                const bookX = x + randomXOffset;
                const bookY = y - h/2 + bookH/2; // Alinha pela base da prateleira

                book.position.set(bookX, bookY, 0);
                book.rotation.y = (Math.random() - 0.5) * 0.2;
                group.add(book);
            }
        }

        function onMouseMove(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            mouseX = event.clientX;
            mouseY = event.clientY;
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(interactiveObjects);

            if (intersects.length > 0) {
                if (intersectedObject !== intersects[0].object) {
                    intersectedObject = intersects[0].object;
                    tooltip.innerHTML = `<h3>${intersectedObject.userData.title}</h3><p>${intersectedObject.userData.description}</p>`;
                }
                tooltip.style.display = 'block';
                tooltip.style.left = `${mouseX + 15}px`;
                tooltip.style.top = `${mouseY + 15}px`;
            } else {
                if (intersectedObject) tooltip.style.display = 'none';
                intersectedObject = null;
            }

            // Atualiza a posição dos títulos visíveis
            for (const labelInfo of labels) {
                const { trigger, element } = labelInfo;
                const worldPosition = new THREE.Vector3();
                trigger.getWorldPosition(worldPosition);
                
                const screenPosition = worldPosition.clone().project(camera);
                
                const isBehind = screenPosition.z > 1;
                element.style.display = isBehind ? 'none' : 'block';

                if (!isBehind) {
                    const x = (screenPosition.x * 0.5 + 0.5) * renderer.domElement.clientWidth;
                    const y = (-screenPosition.y * 0.5 + 0.5) * renderer.domElement.clientHeight;
                    
                    element.style.transform = `translate(-50%, -150%) translate(${x}px, ${y}px)`;
                    element.style.opacity = intersectedObject === trigger ? '0.2' : '1';
                }
            }

            renderer.render(scene, camera);
        }

        init();
        animate();
    </script>
</body>
</html>

